<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // ==========================================
    // A) GLOBAL FONKSİYONLAR (HTML'den çağrılanlar)
    // ==========================================

    // --- 1. SIDEBAR (SAĞ PANEL) AÇ/KAPA ---
    function toggleSidebar() {
        const sidebar = document.getElementById('right-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const body = document.body;

        if (sidebar.classList.contains('translate-x-full')) {
            // AÇ
            sidebar.classList.remove('translate-x-full');
            overlay.classList.remove('hidden');
            setTimeout(() => { overlay.classList.remove('opacity-0'); }, 10); // Animasyon için gecikme
            body.style.overflow = 'hidden'; // Arkaplanı kilitle
        } else {
            // KAPAT
            sidebar.classList.add('translate-x-full');
            overlay.classList.add('opacity-0');
            setTimeout(() => { overlay.classList.add('hidden'); }, 300);
            body.style.overflow = 'auto'; // Arkaplanı aç
        }
    }

    // --- 2. SIDEBAR HIZLI MESAJ GÖNDERME ---
    function sendSidebarMessage(e) {
        e.preventDefault();
        const form = document.getElementById('sidebar-contact-form');
        const btn = document.getElementById('btn-sidebar-submit');

        const originalBtnContent = btn.innerHTML;
        btn.innerHTML = '<span class="animate-spin inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></span>';
        btn.disabled = true;

        const formData = new FormData(form);

        fetch('/Default/SendMessage', { method: 'POST', body: formData })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                toggleSidebar(); // Paneli kapat
                Swal.fire({
                    icon: 'success',
                    title: 'Hızlı Mesaj İletildi!',
                    text: 'Mesajınız başarıyla alındı.',
                    confirmButtonColor: '#6366f1',
                    timer: 3000
                });
                form.reset();
            } else {
                Swal.fire({ icon: 'error', title: 'Hata', text: data.message, confirmButtonColor: '#ef4444' });
            }
        })
        .catch(error => { console.error(error); })
        .finally(() => {
            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
        });
    }

    // --- 3. ANA İLETİŞİM FORMU GÖNDERME ---
    function sendMessage(e) {
        e.preventDefault();
        const form = document.getElementById('contact-form');
        const btn = document.getElementById('btn-submit');

        const originalBtnContent = btn.innerHTML;
        btn.innerHTML = '<span class="animate-spin inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></span> Gönderiliyor...';
        btn.disabled = true;

        const formData = new FormData(form);

        fetch('/Default/SendMessage', { method: 'POST', body: formData })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Mesaj İletildi!',
                    text: 'Teşekkürler, mesajınız başarıyla ulaştı. En kısa sürede dönüş yapacağım.',
                    confirmButtonColor: '#6366f1'
                });
                form.reset();
            } else {
                Swal.fire({ icon: 'error', title: 'Hata!', text: 'Bir sorun oluştu: ' + data.message, confirmButtonColor: '#ef4444' });
            }
        })
        .catch(error => {
            Swal.fire({ icon: 'error', title: 'Bağlantı Hatası!', text: 'Sunucu ile iletişim kurulamadı.', confirmButtonColor: '#ef4444' });
        })
        .finally(() => {
            btn.innerHTML = originalBtnContent;
            btn.disabled = false;
        });
    }

    // --- 4. YUKARI ÇIK (SCROLL TO TOP) ---
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ==========================================
    // B) DOM YÜKLENDİKTEN SONRA ÇALIŞACAKLAR
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. NAVBAR SCROLL EFEKTİ ---
        const navbar = document.getElementById('main-navbar');
        if(navbar) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('bg-white/90', 'backdrop-blur-md', 'shadow-sm', 'py-2');
                    navbar.classList.remove('bg-transparent', 'py-4');
                } else {
                    navbar.classList.remove('bg-white/90', 'backdrop-blur-md', 'shadow-sm', 'py-2');
                    navbar.classList.add('bg-transparent', 'py-4');
                }
            });
        }

        // --- 2. MOBİL MENÜ ---
        const mobileBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileLinks = document.querySelectorAll('.mobile-nav-link');

        if(mobileBtn && mobileMenu) {
            mobileBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });
        }

        // --- 3. TYPEWRITER EFEKTİ (HERO BÖLÜMÜ) ---
        const textElement = document.getElementById('typewriter');
        if(textElement) {
            const phrases = ['Backend Developer.', '.NET Core Uzmanı.', 'Yazılım Mimarı.', 'Teknoloji Tutkunu.'];
            let phraseIndex = 0;
            let charIndex = 0;
            let isDeleting = false;
            let typeSpeed = 100;

            function type() {
                const currentPhrase = phrases[phraseIndex];
                if (isDeleting) {
                    textElement.textContent = currentPhrase.substring(0, charIndex - 1);
                    charIndex--;
                    typeSpeed = 50;
                } else {
                    textElement.textContent = currentPhrase.substring(0, charIndex + 1);
                    charIndex++;
                    typeSpeed = 100;
                }

                if (!isDeleting && charIndex === currentPhrase.length) {
                    isDeleting = true;
                    typeSpeed = 2000;
                } else if (isDeleting && charIndex === 0) {
                    isDeleting = false;
                    phraseIndex = (phraseIndex + 1) % phrases.length;
                    typeSpeed = 500;
                }
                setTimeout(type, typeSpeed);
            }
            type();
        }

        // --- 4. PORTFOLYO FİLTRELEME ---
        const filterBtns = document.querySelectorAll('.filter-btn');
        const portfolioItems = document.querySelectorAll('.portfolio-item');

        if(filterBtns.length > 0) {
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Buton stillerini güncelle
                    filterBtns.forEach(b => {
                        b.classList.remove('bg-brand-600', 'text-white', 'shadow-lg');
                        b.classList.add('bg-white', 'text-slate-600');
                    });
                    btn.classList.remove('bg-white', 'text-slate-600');
                    btn.classList.add('bg-brand-600', 'text-white', 'shadow-lg');

                    // Filtreleme yap
                    const filterValue = btn.getAttribute('data-filter');

                    portfolioItems.forEach(item => {
                        const category = item.getAttribute('data-category');
                        if (filterValue === 'all' || category.includes(filterValue)) {
                            item.style.display = 'block';
                            item.animate([
                                { transform: 'scale(0.9)', opacity: 0 },
                                { transform: 'scale(1)', opacity: 1 }
                            ], { duration: 300, fill: 'forwards' });
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });
        }
    });
</script>